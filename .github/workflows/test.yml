name: CI â€” install mamba & gcc/gxx

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install micromamba (single binary)
        run: |
          curl -L https://micro.mamba.pm/api/micromamba/linux-64/latest \
            | tar -xvj bin/micromamba
          sudo mv bin/micromamba /usr/local/bin/micromamba
          sudo chmod +x /usr/local/bin/micromamba
          micromamba --version

      - name: Create environment and install mamba
        run: |
          micromamba create -y -n ci -c conda-forge python=3.11 mamba

      - name: Show python and mamba versions (run each directly)
        run: |
          micromamba run -n ci -- python --version
          micromamba run -n ci -- mamba --version

      - name: Install gcc/gxx 14.1.0 from conda-forge
        run: |
          micromamba run -n ci -- mamba install -y -c conda-forge \
            conda-forge::gcc=14.1.0 conda-forge::gxx=14.1.0

      - name: Verify gcc/g++ are available inside env
        run: |
          micromamba run -n ci -- which gcc || true
          micromamba run -n ci -- which g++ || true
          micromamba run -n ci -- gcc --version || true
          micromamba run -n ci -- g++ --version || true

name: CI â€” install gcc/g++ with micromamba

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install micromamba (single binary)
        run: |
          curl -L https://micro.mamba.pm/api/micromamba/linux-64/latest \
            | tar -xvj bin/micromamba
          sudo mv bin/micromamba /usr/local/bin/micromamba
          sudo chmod +x /usr/local/bin/micromamba
          micromamba --version

      - name: Create env 'ci' (python + mamba optional)
        run: |
          micromamba create -y -n ci -c conda-forge python=3.11 mamba
          micromamba info

      - name: Install gcc/g++ 15.2.0 into env ci (fixed)
        run: |
          # Use micromamba to install directly into the env; quote the specs to avoid parser issues
          micromamba install -y -n ci -c conda-forge 'conda-forge::gcc=15.2.0' 'conda-forge::gxx=15.2.0'

      - name: Verify gcc/g++ inside env
        run: |
          micromamba run -n ci -- gcc --version || true
          micromamba run -n ci -- g++ --version || true
